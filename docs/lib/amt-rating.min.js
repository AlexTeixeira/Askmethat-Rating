"use strict";var AskmethatRatingSteps;!function(t){t[t.DecimalStep=0]="DecimalStep",t[t.HalfStep=1]="HalfStep",t[t.OnePerOneStep=2]="OnePerOneStep"}(AskmethatRatingSteps=AskmethatRatingSteps||(AskmethatRatingSteps={}));var AskmethatRating=function(){function t(t,e,i){var a=this;if(this._defaultOptions={hoverColor:"#ffff66",backgroundColor:"#e5e500",minRating:1,maxRating:5,fontClass:"fa fa-star",readonly:!1,step:AskmethatRatingSteps.DecimalStep,inputName:"AskmethatRating"},this.parentElement=t,i&&(this._defaultOptions.hoverColor=null!=i.hoverColor?i.hoverColor:this._defaultOptions.hoverColor,this._defaultOptions.backgroundColor=null!=i.backgroundColor?i.backgroundColor:this._defaultOptions.backgroundColor,this._defaultOptions.minRating=null!=i.minRating?i.minRating:this._defaultOptions.minRating,this._defaultOptions.maxRating=null!=i.maxRating?i.maxRating:this._defaultOptions.maxRating,this._defaultOptions.fontClass=null!=i.fontClass?i.fontClass:this._defaultOptions.fontClass,this._defaultOptions.readonly=null!=i.readonly?i.readonly:this._defaultOptions.readonly,this._defaultOptions.step=null!=i.step?i.step:this._defaultOptions.step,this._defaultOptions.inputName=null!=i.inputName?i.inputName:this._defaultOptions.inputName),this._defaultOptions.minRating>e)throw new Error("Default value should be higher than minRating options");this._defaultOptions.readonly||this.parentElement.addEventListener("mouseleave",function(t){return a.onMouseLeave(t)}),this.mouseMove=this.onMouseMove.bind(this),this.ratingClick=this.onRatingClick.bind(this),this.render(e)}return Object.defineProperty(t.prototype,"value",{get:function(){return this.pValue},set:function(t){if(t<this._defaultOptions.minRating)throw Error("New value cannot be less than min rating value");this.pValue=t,this.render(this.pValue)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultOptions",{get:function(){return this._defaultOptions},enumerable:!0,configurable:!0}),t.prototype.render=function(t){void 0===t&&(t=this._defaultOptions.minRating),this.parentElement.innerHTML="";for(var e=1;e<=this._defaultOptions.maxRating;e++){var i=document.createElement("span"),a=document.createElement("span");if(a.className=this._defaultOptions.fontClass,a.className+=" amt-rating-elem amt-rating-under amt-rating",a.setAttribute("data-rating",e.toString()),a.style.color=this._defaultOptions.backgroundColor,i.className+=this._defaultOptions.fontClass,i.className+=" amt-rating-under am-rating",i.style.color=this._defaultOptions.hoverColor,i.style.width="0%",e<=t)a.classList.contains("amt-active")||(a.className+=" amt-active"),i.style.width="100%",e===t&&(a.className+=" amt-selected");else if(Number(t.toFixed(1))>=e-1&&Number(t.toFixed(1))<e&&t%1!==0){a.className+=" amt-active amt-selected";var n=Number((t%1).toFixed(1));i.style.width=100*n+"%"}else a.style.color=this._defaultOptions.backgroundColor,a.classList.remove("amt-active"),i.style.width="0%";this.pValue=t,this._defaultOptions.readonly||(a.addEventListener("click",this.ratingClick),a.addEventListener("mousemove",this.mouseMove)),a.appendChild(i),this.parentElement.appendChild(a)}var s=document.createElement("input");s.setAttribute("type","hidden"),s.setAttribute("value",this.pValue.toString()),s.setAttribute("name",this._defaultOptions.inputName),this.parentElement.appendChild(s),this.mutationEvent()},t.prototype.onRatingClick=function(t){var e=t.srcElement,i=e.querySelector(".amt-rating-under"),a=Number(e.getAttribute("data-rating")),n=a-1+Number((.01*parseInt(i.style.width,10)).toFixed(1));if(!(n<this._defaultOptions.minRating)){0!==this.value&&this.parentElement.querySelector(".amt-selected").classList.remove("amt-selected"),this.pValue=n,0!=this.value&&(e.className+=" amt-selected"),this.changeEvent=new CustomEvent("amt-change",{detail:this.value}),this.changeEvent.initEvent("amt-change",!1,!0),this.parentElement.dispatchEvent(this.changeEvent);var s=this.parentElement.getElementsByTagName("input")[0];s.value=this.pValue.toString()}},t.prototype.getValueAccordingToStep=function(t){switch(this.defaultOptions.step){case AskmethatRatingSteps.HalfStep:return Math.round(2*t)/2;case AskmethatRatingSteps.OnePerOneStep:return Math.ceil(t);default:return t}},t.prototype.onMouseMove=function(t){var e=t.srcElement,i=Number(e.getAttribute("data-rating")),a=Number((t.offsetX/t.srcElement.clientWidth*100).toFixed(0)),n=i-1+Number((.01*a).toFixed(1));if(n=this.getValueAccordingToStep(n),Number(n)&&isFinite(n))this.setOrUnsetActive(n);else{if(0==n)return void this.setOrUnsetActive(n);this.setOrUnsetActive(i)}},t.prototype.onMouseLeave=function(t){this.setOrUnsetActive(this.value)},t.prototype.setOrUnsetActive=function(t){for(var e=1;e<=this._defaultOptions.maxRating;e++)if(!(e<this._defaultOptions.minRating)){var i=this.parentElement.querySelector(".amt-rating-elem[data-rating='"+e+"']"),a=i.querySelector(".amt-rating-under");if(e<=t){i.classList.contains("amt-active")||(i.className+=" amt-active");var a=i.querySelector(".amt-rating-under");a.style.width="100%"}else if(Number(t.toFixed(1))>=e-1&&Number(t.toFixed(1))<e&&t%1!==0){a.className+=" amt-active";var n=Number((t%1).toFixed(1));a.style.width=100*n+"%"}else i.style.color=this._defaultOptions.backgroundColor,i.classList.remove("amt-active"),a.style.width="0%"}},t.prototype.mutationEvent=function(){var t=this,e=this.parentElement.querySelector("input"),i=new MutationObserver(function(e){e.forEach(function(e){if("disabled"===e.attributeName){var i=e.target,a=i.hasAttribute("disabled"),n=t.parentElement.querySelectorAll(".amt-rating-elem");if(a)for(var s=0;s<n.length;s++)n[s].removeEventListener("click",t.ratingClick),n[s].removeEventListener("mousemove",t.mouseMove);else for(var s=0;s<n.length;s++)n[s].addEventListener("click",t.ratingClick),n[s].addEventListener("mousemove",t.mouseMove)}})}),a={attributes:!0,childList:!0,characterData:!0};i.observe(e,a)},t.value=function(t){var e=document.querySelector(t);if(void 0===e||null===e)throw new Error("container do not exist");var i=e.querySelector(".amt-selected"),a=i.querySelector(".amt-rating-under"),n=Number(i.getAttribute("data-rating")),s=n-1+Number((.01*parseInt(a.style.width,10)).toFixed(1));return s},t}();